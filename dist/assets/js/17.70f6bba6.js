(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{258:function(_,v,t){"use strict";t.r(v);var a=t(5),s=Object(a.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[_._v("#")]),_._v(" MySQL")]),_._v(" "),t("h2",{attrs:{id:"阿里开发手册之-mysql-编程规范借鉴"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里开发手册之-mysql-编程规范借鉴"}},[_._v("#")]),_._v(" 阿里开发手册之 MySQL 编程规范借鉴")]),_._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[_._v("TIP")]),_._v(" "),t("p",[_._v("站在巨人的肩膀上，你会少走很多弯路。--鲁迅")])]),_._v(" "),t("h3",{attrs:{id:"建表规约"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建表规约"}},[_._v("#")]),_._v(" 建表规约")]),_._v(" "),t("p",[_._v("表名，字段名必须使用全"),t("strong",[_._v("小写")]),_._v("字母，下划线，数字。禁止出现数字开头，禁止两个下划线中间中出现数字。")]),_._v(" "),t("p",[_._v("表名使用单数形式。")]),_._v(" "),t("p",[_._v("字段名不能使用 MySQL 保留字。如 asc, desc, match 等。")]),_._v(" "),t("p",[_._v("主键索引名为 pk_字段名;唯一索引名为 uk_字段名;普通索引名则为 idx_字段名。")]),_._v(" "),t("p",[_._v("数据库字段修改的代价很大，无法进行预发布，所以建表时需认真对待，慎重考虑。")]),_._v(" "),t("p",[_._v("表达是否或者开关等概念的字段，必须使用 "),t("code",[_._v("is_xxx")]),_._v(" 的命名方式。数据类型使用 unsigned tinyint(1)。")]),_._v(" "),t("p",[_._v("比如软删除字段: "),t("code",[_._v("is_deleted")]),_._v(" 1 表示删除（正向，肯定）；2 表示未删除（负向，否定）。")]),_._v(" "),t("p",[_._v("小数使用 decimal")]),_._v(" "),t("ul",[t("li",[_._v("float 和 double 类型的列，在做计算时，可能丢失精度，而 decimal 会精确计算。")]),_._v(" "),t("li",[_._v("float 和 double 在设置超过定义长度的数值时，会自动四舍五入，decimal会截断，并给出一条警告。")])]),_._v(" "),t("p",[_._v("如果存储的字符串长度几乎相等，使用 char 定长字符串类型。")]),_._v(" "),t("p",[_._v("varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长 度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索 引效率。")]),_._v(" "),t("p",[_._v("MySQL5.0 以上版本，varchar 最大可以存储 65535 字节数据（其中1-2个字节存储长度信息，还有 null 标志位）。此外，还受到行大小的限制，行长度不能超过 65535 字节。")]),_._v(" "),t("p",[_._v("在 UTF-8 编码下，一个汉字占 3 个字节，那么最大字符数不能超过 21845.")]),_._v(" "),t("p",[_._v("表定义中的 varchar(10) 表示的是 10 个字符，而不是字节数。")]),_._v(" "),t("p",[_._v("通用字段：")]),_._v(" "),t("ul",[t("li",[_._v("id: 类型为 bigint unsigned，自增，步长 1")]),_._v(" "),t("li",[t("s",[_._v("gmt_create")])]),_._v(" "),t("li",[t("s",[_._v("gmt_modified")])]),_._v(" "),t("li",[_._v("is_deleted")])]),_._v(" "),t("p",[_._v("个人觉得创建时间和更新时间还是 created_at 和 updated_at 更好些，简单易理解。")]),_._v(" "),t("p",[_._v("表名命名采用 “业务名称+表的作用”形式。如 alipay_task。")]),_._v(" "),t("p",[_._v("库名与应用名称尽量一致。")]),_._v(" "),t("p",[_._v("如果更新表字段含义或对状态字段追加枚举值时，需要更新字段注释。")]),_._v(" "),t("p",[_._v("字段允许适当冗余，以提高查询性能，但必须考虑数据一致性，冗余字段应遵循：")]),_._v(" "),t("ul",[t("li",[_._v("不是频繁修改的字段。")]),_._v(" "),t("li",[_._v("不能是 varchar 超长字段，更不能是 text 类型字段。正例： 商品类目名称使用频率高，字段长度短，名称基本一成不变，可在相关联的表中冗余存储类目名称，避免关联查询。")])]),_._v(" "),t("p",[_._v("单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。")]),_._v(" "),t("p",[_._v("合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速度。例如年龄字段或者状态枚举字段，在明确知道其范围的情况下，完全可以限定其类型长度。")]),_._v(" "),t("h3",{attrs:{id:"索引规约"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引规约"}},[_._v("#")]),_._v(" 索引规约")]),_._v(" "),t("p",[_._v("业务上具有唯一性的字段，即使是多字段的组合，也必须建成唯一索引。")]),_._v(" "),t("ul",[t("li",[_._v("说明：唯一索引是保证业务数据唯一性的强有力保障，单纯靠应用层代码控制，很难做到 100% 唯一性。虽然索引会影响 insert 速度，但几乎可以忽略，它提高查询的速度更明显。")])]),_._v(" "),t("p",[_._v("禁止超过 3 个表 join，需要 join 关联的字段，数据类型必须一致，必须有索引。")]),_._v(" "),t("p",[_._v("对 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度。")]),_._v(" "),t("p",[_._v("对于blob,text,varchar的列必须使用前缀索引。")]),_._v(" "),t("Vssue")],1)}),[],!1,null,null,null);v.default=s.exports}}]);